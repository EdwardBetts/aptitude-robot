#!/usr/bin/perl
use strict;
use warnings;
use 5.010;
use English qw( -no_match_vars );

use Test::More;

use IPC::Run qw( run );

my $in = '';
my $out;
my $err;
my $cmd;

$cmd = [
    '@abs_top_srcdir@/aptitude-robot',
    '--config-dir=/dev/null',
    '--show-cmdline',
];
ok(
    not(run( $cmd, \$in, \$out, \$err )),
    'should complain about non-existant config dir'
);

$cmd = [
    '@abs_top_srcdir@/aptitude-robot',
    '--config-dir=@abs_top_srcdir@/t/testdata/empty-config',
    '--show-cmdline',
];
ok(
    run( $cmd, \$in, \$out, \$err ),
    'empty config dir should give only `aptitude install ~U`'
);

is( $out, "aptitude -y install ~U\n",
    'command line should be `aptitude -y install ~U`');

done_testing();
